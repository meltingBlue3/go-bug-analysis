<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>禅道 Bug 分析工具</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="app-header">
        <div class="header-left">
            <svg class="header-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 20V10M18 20V4M6 20v-4"/>
            </svg>
            <h1 class="header-title">禅道 Bug 分析工具</h1>
        </div>
        <div class="header-right">
            <span class="version-badge">v1.0</span>
        </div>
    </header>

    <!-- 上传区域 -->
    <section id="upload-section" class="upload-section">
        <div class="upload-card">
            <div class="upload-icon">
                <svg viewBox="0 0 64 64" width="64" height="64" fill="none" stroke="var(--primary)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M40 8H16a4 4 0 0 0-4 4v40a4 4 0 0 0 4 4h32a4 4 0 0 0 4-4V20L40 8z"/>
                    <polyline points="40,8 40,20 52,20"/>
                    <line x1="32" y1="34" x2="32" y2="46"/>
                    <polyline points="26,40 32,34 38,40"/>
                </svg>
            </div>
            <h2 class="upload-title">导入 CSV 数据</h2>
            <p class="upload-desc">选择禅道导出的 CSV 文件，开始分析 Bug 数据</p>
            <label class="upload-btn" for="csv-file">
                <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor">
                    <path d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                </svg>
                选择 CSV 文件
                <input type="file" id="csv-file" accept=".csv" hidden>
            </label>
            <p class="upload-hint">支持 GBK / UTF-8 编码，文件大小不限</p>
            <div id="upload-status"></div>
        </div>
    </section>

    <!-- 仪表盘区域 -->
    <main id="dashboard" class="dashboard" style="display: none;">
        <!-- 仪表盘顶栏 -->
        <div class="dashboard-header">
            <h2 class="dashboard-title">数据概览</h2>
            <button class="reimport-btn" id="btn-reimport">
                <svg viewBox="0 0 20 20" width="14" height="14" fill="currentColor">
                    <path d="M4.293 15.707a1 1 0 010-1.414l5-5a1 1 0 011.414 0l5 5a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414 0z" transform="rotate(-90 10 10)"/>
                </svg>
                重新导入
            </button>
        </div>

        <!-- KPI 卡片行 -->
        <div id="kpi-cards" class="card-row">
            <div class="kpi-card placeholder-card" id="kpi-today-new">
                <div class="kpi-label">今日新增</div>
                <div class="kpi-value">—</div>
                <div class="kpi-sub">昨日: —</div>
            </div>
            <div class="kpi-card placeholder-card" id="kpi-today-fixed">
                <div class="kpi-label">今日修复</div>
                <div class="kpi-value">—</div>
                <div class="kpi-sub">昨日: —</div>
            </div>
            <div class="kpi-card placeholder-card" id="kpi-total">
                <div class="kpi-label">Bug 总数</div>
                <div class="kpi-value">—</div>
                <div class="kpi-sub" style="display:none"></div>
            </div>
            <div class="kpi-card placeholder-card" id="kpi-active">
                <div class="kpi-label">激活 Bug</div>
                <div class="kpi-value">—</div>
                <div class="kpi-sub" style="display:none"></div>
            </div>
            <div class="kpi-card placeholder-card" id="kpi-pending">
                <div class="kpi-label">待验证</div>
                <div class="kpi-value">—</div>
                <div class="kpi-sub" style="display:none"></div>
            </div>
        </div>

        <!-- 图表行 -->
        <div id="charts-row" class="chart-row">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">严重程度分布</h3>
                    <div class="chart-controls">
                        <div class="toggle-group" id="severity-type-toggle">
                            <button class="toggle-btn active" data-value="pie">饼图</button>
                            <button class="toggle-btn" data-value="bar">柱状图</button>
                        </div>
                        <div class="toggle-group" id="severity-scope-toggle">
                            <button class="toggle-btn active" data-value="all">全部</button>
                            <button class="toggle-btn" data-value="new">仅新增</button>
                        </div>
                    </div>
                </div>
                <div class="chart-container" id="chart-severity">
                    <div class="placeholder-text">数据加载后显示</div>
                </div>
            </div>
        </div>

        <!-- 修复时效行 -->
        <div class="chart-row">
            <div class="chart-card" id="fix-time-stats-card">
                <h3 class="chart-title">修复时效统计</h3>
                <div class="fix-time-summary" id="fix-time-summary">
                    <div class="placeholder-text">数据加载后显示</div>
                </div>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">修复时长分布</h3>
                <div class="chart-container chart-container-sm" id="chart-fix-time-dist">
                    <div class="placeholder-text">数据加载后显示</div>
                </div>
            </div>
        </div>

        <!-- 未解决 Bug 积压排名 -->
        <div class="data-table-card" id="backlog-card">
            <div class="chart-header">
                <h3 class="chart-title">未解决 Bug 积压排名</h3>
                <span class="backlog-count" id="backlog-count"></span>
            </div>
            <div class="table-scroll">
                <table class="data-table" id="backlog-table">
                    <thead>
                        <tr>
                            <th>Bug编号</th>
                            <th>标题</th>
                            <th>严重程度</th>
                            <th>指派给</th>
                            <th>创建日期</th>
                            <th>积压天数</th>
                        </tr>
                    </thead>
                    <tbody id="backlog-tbody">
                        <tr><td colspan="6" class="placeholder-text">数据加载后显示</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 人员工作负载分布 -->
        <div class="chart-row" id="workload-row">
            <div class="chart-card">
                <h3 class="chart-title">当前激活 Bug 分布（按指派人）</h3>
                <div class="chart-container chart-container-dynamic" id="chart-workload-active"></div>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">Bug 总量分布（按指派人）</h3>
                <div class="chart-container chart-container-dynamic" id="chart-workload-total"></div>
            </div>
        </div>

        <!-- 模块质量分析 -->
        <div class="section-divider">
            <h2 class="section-title">模块质量分析</h2>
        </div>

        <!-- 模块统计表 -->
        <div class="data-table-card" id="module-stats-card">
            <div class="chart-header">
                <h3 class="chart-title">模块 Bug 统计</h3>
                <span class="module-count" id="module-count"></span>
            </div>
            <div class="table-scroll table-scroll-md">
                <table class="data-table sortable-table" id="module-table">
                    <thead>
                        <tr>
                            <th data-sort="name">模块名称</th>
                            <th data-sort="total" class="sort-active sort-desc">Bug 总数 ▼</th>
                            <th data-sort="active">激活数</th>
                            <th data-sort="rate">激活率</th>
                        </tr>
                    </thead>
                    <tbody id="module-tbody">
                        <tr><td colspan="4" class="placeholder-text">数据加载后显示</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 模块 × 严重程度热力图 -->
        <div class="chart-row">
            <div class="chart-card chart-card-full">
                <h3 class="chart-title">模块 × 严重程度 热力图</h3>
                <div class="chart-container chart-container-dynamic" id="chart-module-heatmap"></div>
            </div>
        </div>

        <!-- 模块 Bug 趋势 -->
        <div class="chart-row">
            <div class="chart-card chart-card-full">
                <div class="chart-header">
                    <h3 class="chart-title">模块 Bug 新增趋势</h3>
                    <div class="chart-controls">
                        <div class="toggle-group" id="trend-range-toggle">
                            <button class="toggle-btn" data-value="7">近 7 天</button>
                            <button class="toggle-btn active" data-value="30">近 30 天</button>
                        </div>
                    </div>
                </div>
                <div class="chart-container chart-container-lg" id="chart-module-trend">
                    <div class="placeholder-text">数据加载后显示</div>
                </div>
            </div>
        </div>

        <!-- 日报生成 -->
        <div class="section-divider">
            <h2 class="section-title">质量日报</h2>
        </div>

        <div class="report-card" id="report-section">
            <div class="chart-header">
                <h3 class="chart-title">日报内容</h3>
                <div class="chart-controls">
                    <div class="toggle-group" id="report-format-toggle">
                        <button class="toggle-btn active" data-value="plain">纯文本</button>
                        <button class="toggle-btn" data-value="markdown">Markdown</button>
                    </div>
                    <button class="copy-btn" id="btn-copy-report">
                        <svg viewBox="0 0 20 20" width="14" height="14" fill="currentColor">
                            <path d="M8 2a2 2 0 00-2 2v1H5a2 2 0 00-2 2v9a2 2 0 002 2h7a2 2 0 002-2v-1h1a2 2 0 002-2V6.414A2 2 0 0016.414 5L14 2.586A2 2 0 0012.586 2H8zm4 11H5V7h3v2a1 1 0 001 1h3v3zm0-5H9V5.5L12.5 8H12z"/>
                        </svg>
                        复制日报
                    </button>
                </div>
            </div>
            <pre class="report-content" id="report-content">数据加载后显示</pre>
            <div class="copy-toast" id="copy-toast">已复制到剪贴板</div>
        </div>
    </main>

    <script src="js/lib/echarts.min.js"></script>
    <script src="js/app.js" defer></script>
    <script src="js/dashboard.js" defer></script>
</body>
</html>
